steps:
- id: Build C2D Docker Image
  name: gcr.io/cloud-builders/docker
  args:
  - build
  - --tag
  - dockertools
  - --file
  - tools/dockertools.Dockerfile
  - tools

- id: Share dockertools using workspaces
  name: dockertools
  entrypoint: bash
  args:
  - -c
  - |
    cp /bin/cloudbuild /workspace/cloudbuild &&
    cp /bin/dockerfiles /workspace/dockerfiles

- id: Create a new GitHub Release.
  name: dockertools
  entrypoint: bash
  args:
  - -c
  - |
    gh release create $TAG_NAME --target mjanas-dockertools --notes "Dockertools" /workspace/{cloudbuild,dockerfiles}
  secretEnv: ['GH_TOKEN']
  
artifacts:
  objects:
    location: 'gs://$PROJECT_ID-mjanas/'
    paths: ['/workspace/cloudbuild', '/workspace/dockerfiles']

availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/GH_TOKEN/versions/1
    env: 'GH_TOKEN'