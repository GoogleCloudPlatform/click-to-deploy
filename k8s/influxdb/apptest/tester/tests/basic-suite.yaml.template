actions:
- name: Wait until InfluxDB is ready
  bashTest:
    script: |-
      kubectl wait --namespace=${NAMESPACE} --for=condition=Ready --timeout=180s pod/${APP_INSTANCE_NAME}-influxdb-0
    expect:
      exitCode:
        equals: 0
- name: InfluxDB URL should be 204 No Content
  httpTest:
    url: http://${APP_INSTANCE_NAME}-influxdb-svc:8086/ping
    expect:
      statusCode:
        equals: 204
- name: Can create a database
  bashTest:
    script: |-
      curl "http://${APP_INSTANCE_NAME}-influxdb-svc:8086/query?u=${INFLUXDB_ADMIN_USER}&p=${INFLUXDB_ADMIN_PASSWORD}" --data-urlencode "q=CREATE DATABASE NOAA_water_database"
    expect:
      stdout:
        contains: '{"results":[{"statement_id":0}]}'
      exitCode:
        equals: 0
- name: Can read a database
  bashTest:
    script: |-
      curl "http://${APP_INSTANCE_NAME}-influxdb-svc:8086/query?u=${INFLUXDB_ADMIN_USER}&p=${INFLUXDB_ADMIN_PASSWORD}" --data-urlencode "q=SHOW DATABASES"
    expect:
      stdout:
        contains: 'NOAA_water_database'
      exitCode:
        equals: 0
