apiVersion: v1
kind: List
items:
- apiVersion: v1
  kind: Secret
  metadata:
    name: $NAME-secrets
    labels: &MySQLLabels
      app.kubernetes.io/name: "$NAME"
      app.kubernetes.io/component: mysql
  type: Opaque
  stringData:
    STORAGE_FLAG: --mysql_uri=$MYSQL_TRILLIAN_USER:$MYSQL_TRILLIAN_PASSWORD@tcp(${NAME}-mysql-service:3306)/$MYSQL_TRILLIAN_DATABASE
- apiVersion: v1
  kind: Secret
  metadata:
    name: $NAME-mysql-secrets
    labels: *MySQLLabels
  type: Opaque
  stringData:
    MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
    MYSQL_USER: "${MYSQL_TRILLIAN_USER}"
    MYSQL_PASSWORD: "${MYSQL_TRILLIAN_PASSWORD}"
    MYSQL_DATABASE: "${MYSQL_TRILLIAN_DATABASE}"
- apiVersion: v1
  kind: Service
  metadata:
    name: $NAME-mysql-service
    labels: *MySQLLabels
  spec:
    clusterIP: None
    ports:
    - name: mysql
      port: 3306
    selector: *MySQLLabels
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: $NAME-mysql
    labels: *MySQLLabels
  spec:
    replicas: 1
    selector:
      matchLabels: *MySQLLabels
    template:
      metadata:
        labels: *MySQLLabels
      spec:
        containers:
        - image: $IMAGE_MYSQL
          name: mysql
          envFrom:
          - secretRef:
              name: $NAME-mysql-secrets
        restartPolicy: Always
