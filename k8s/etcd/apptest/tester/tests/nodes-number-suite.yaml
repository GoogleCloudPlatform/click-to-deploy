actions:

- name: There are exactly 3 nodes in a cluster
  bashTest:
    script: |-
      kubectl get sts "${APP_INSTANCE_NAME}-etcd" \
        --namespace "${NAMESPACE}" \
        --output jsonpath="{.spec.replicas}"
    expect:
      stdout:
        equals: '3'

- name: Check if there are 3 members in etcd cluster
  bashTest:
    script: |-
      kubectl exec -it ${APP_INSTANCE_NAME}-etcd-0 \
        --namespace "${NAMESPACE}" \
        -- etcdctl --user root:${ETCD_ROOT_PASSWORD} endpoint status --cluster | wc -l
    expect:
      stdout:
        equals: 3
