---
{{- $secret := (lookup "v1" "Secret" .Release.Namespace (printf "%s-config-envs" .Release.Name)) -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-config-envs
  labels:
    app.kubernetes.io/name: "{{ .Release.Name }}"
    app.kubernetes.io/component: keycloak
data:
  {{- if $secret }}
  POSTGRES_PASSWORD: {{ $secret.data.POSTGRES_PASSWORD }}
  CONJUR_DATA_KEY: {{ $secret.data.CONJUR_DATA_KEY }}
  {{- else }}
  POSTGRES_PASSWORD: {{ randAlphaNum 32 | b64enc | quote }}
  CONJUR_DATA_KEY: {{ randAlphaNum 32 | b64enc | b64enc | quote }}
  {{- end }}
  DATABASE_URL: {{ `echo -n "postgres://conjur:$(eval $POSTGRES_PASSWORD)@${DATABASE_HOST}/conjur"` | b64enc | quote }}



