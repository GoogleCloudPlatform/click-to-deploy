x-google-marketplace:
  schemaVersion: v2
  applicationApiVersion: v1beta1
  publishedVersion: "1.7.3"
  publishedVersionMetadata:
    releaseNote: >-
      Initial release.
    releaseTypes:
    - Beta
    recommended: false
  managedUpdates:
    kalmSupported: false
  images:
    ? ''
    : properties:
        imageLocation:
          type: FULL
  clusterConstraints:
    k8sVersion: "1.16 - 1.18"
    resources:
    - requests:
        cpu: 4
      replicas: 4
      affinity:
        simpleNodeAffinity:
          type: REQUIRE_ONE_NODE_PER_REPLICA
    istio:
      type: UNSUPPORTED
  deployerServiceAccount:
    description: >
      Creates the designated namespace, as well as starts the istio-operator controller.
    roles:
    - type: ClusterRole
      rulesType: CUSTOM
      rules:
      - apiGroups: ['apiextensions.k8s.io', 'rbac.authorization.k8s.io']
        resources: ['customresourcedefinitions', 'clusterroles', 'clusterrolebindings']
        verbs: ['*']
      - apiGroups:
        - ""
        resources:
        - namespaces
        verbs:
        - "*"
properties:
  name:
    type: string
    x-google-marketplace:
      type: NAME
  operatorNamespace:
    type: string
    default: "istio-operator"
    x-google-marketplace:
      type: NAMESPACE
  istioNamespace:
    type: string
    default: "istio-system"
    title: Istio system namespace
  serviceAccountName:
    type: string
    x-google-marketplace:
      type: SERVICE_ACCOUNT
      serviceAccount:
        description: >
          Installs CRDs and operator, and runs controller that monitors the
          istioNamespace for IstioOperator CRs. Creates, updates, and configures
          control planes as necessary.
        roles:
        - type: ClusterRole
          rulesType: CUSTOM
          rules:
          # istio groups
          - apiGroups:
            - authentication.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          - apiGroups:
            - config.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          - apiGroups:
            - install.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          - apiGroups:
            - networking.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          - apiGroups:
            - rbac.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          - apiGroups:
            - security.istio.io
            resources:
            - '*'
            verbs:
            - '*'
          # k8s groups
          - apiGroups:
            - admissionregistration.k8s.io
            resources:
            - mutatingwebhookconfigurations
            - validatingwebhookconfigurations
            verbs:
            - '*'
          - apiGroups:
            - apiextensions.k8s.io
            resources:
            - customresourcedefinitions.apiextensions.k8s.io
            - customresourcedefinitions
            verbs:
            - '*'
          - apiGroups:
            - apps
            - extensions
            resources:
            - daemonsets
            - deployments
            - deployments/finalizers
            - ingresses
            - replicasets
            - statefulsets
            verbs:
            - '*'
          - apiGroups:
            - autoscaling
            resources:
            - horizontalpodautoscalers
            verbs:
            - '*'
          - apiGroups:
            - monitoring.coreos.com
            resources:
            - servicemonitors
            verbs:
            - get
            - create
          - apiGroups:
            - policy
            resources:
            - poddisruptionbudgets
            verbs:
            - '*'
          - apiGroups:
            - rbac.authorization.k8s.io
            resources:
            - clusterrolebindings
            - clusterroles
            - roles
            - rolebindings
            verbs:
            - '*'
          - apiGroups:
            - ""
            resources:
            - configmaps
            - endpoints
            - events
            - namespaces
            - pods
            - persistentvolumeclaims
            - secrets
            - services
            - serviceaccounts
            verbs:
            - '*'
  deployerHelm.image:
    type: string
    x-google-marketplace:
      type: DEPLOYER_IMAGE
required:
- name
- operatorNamespace
- istioNamespace
- serviceAccountName
